<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PWA SAARCISinistres</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#dc2626">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .icon-preview {
            width: 64px;
            height: 64px;
            margin: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            background: #1E40AF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1e3a8a; }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test PWA SAARCISinistres</h1>
    
    <div class="test-section">
        <h2>üì± √âtat de l'Installation PWA</h2>
        <div id="pwa-status" class="status info">‚è≥ V√©rification en cours...</div>
        <button id="install-btn" style="display:none;">üì± Installer l'App</button>
        <button id="reset-btn">üîÑ R√©initialiser l'√âtat</button>
    </div>
    
    <div class="test-section">
        <h2>üé® Test des Ic√¥nes PWA</h2>
        <div class="icon-grid">
            <div>
                <img src="/icons/icon-16x16.png" alt="16x16" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 16x16</div>
                <div style="text-align:center; font-size:12px;">16x16</div>
            </div>
            <div>
                <img src="/icons/icon-32x32.png" alt="32x32" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 32x32</div>
                <div style="text-align:center; font-size:12px;">32x32</div>
            </div>
            <div>
                <img src="/icons/icon-48x48.png" alt="48x48" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 48x48</div>
                <div style="text-align:center; font-size:12px;">48x48</div>
            </div>
            <div>
                <img src="/icons/icon-96x96.png" alt="96x96" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 96x96</div>
                <div style="text-align:center; font-size:12px;">96x96</div>
            </div>
            <div>
                <img src="/icons/icon-128x128.png" alt="128x128" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 128x128</div>
                <div style="text-align:center; font-size:12px;">128x128</div>
            </div>
            <div>
                <img src="/icons/icon-192x192.png" alt="192x192" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 192x192</div>
                <div style="text-align:center; font-size:12px;">192x192</div>
            </div>
            <div>
                <img src="/icons/icon-512x512.png" alt="512x512" class="icon-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display:none; color:red;">‚ùå 512x512</div>
                <div style="text-align:center; font-size:12px;">512x512</div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üé® Aper√ßu des Logos SVG</h2>
        <div style="text-align:center;">
            <h3>Logo Principal</h3>
            <img src="/icons/icon-saarcisinistres.svg" alt="Logo Principal" style="width:200px; height:200px; border-radius:20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
            
            <h3>Logo Simplifi√©</h3>
            <img src="/icons/icon-saarcisinistres-simple.svg" alt="Logo Simplifi√©" style="width:200px; height:200px; border-radius:20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
        </div>
    </div>
    
    <div class="test-section">
        <h2>üîß Informations de Debug</h2>
        <div id="debug-info" class="status info">
            <pre id="debug-content">Chargement...</pre>
        </div>
    </div>

    <script>
        // Test de l'installation PWA
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        const resetBtn = document.getElementById('reset-btn');
        const statusDiv = document.getElementById('pwa-status');
        const debugContent = document.getElementById('debug-content');

        // Fonction pour mettre √† jour le statut
        function updateStatus() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isIOSStandalone = window.navigator.standalone === true;
            const wasAccepted = localStorage.getItem('pwa-installation-accepted') === 'true';
            const wasDismissed = localStorage.getItem('pwa-installation-dismissed') === 'true';
            
            const debugInfo = {
                isStandalone,
                isIOSStandalone,
                wasAccepted,
                wasDismissed,
                userAgent: navigator.userAgent,
                serviceWorker: 'serviceWorker' in navigator,
                manifest: document.querySelector('link[rel="manifest"]') ? 'Pr√©sent' : 'Manquant'
            };
            
            debugContent.textContent = JSON.stringify(debugInfo, null, 2);
            
            if (isStandalone || isIOSStandalone) {
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ PWA d√©j√† install√© et en mode standalone';
                installBtn.style.display = 'none';
            } else if (wasAccepted) {
                statusDiv.className = 'status warning';
                statusDiv.textContent = '‚ö†Ô∏è PWA marqu√© comme install√© mais pas en mode standalone';
                installBtn.style.display = 'none';
            } else if (wasDismissed) {
                statusDiv.className = 'status warning';
                statusDiv.textContent = '‚ùå Installation refus√©e par l\'utilisateur';
                installBtn.style.display = 'block';
            } else {
                statusDiv.className = 'status info';
                statusDiv.textContent = '‚ÑπÔ∏è PWA pr√™t √† √™tre install√©';
                installBtn.style.display = 'block';
            }
        }

        // √âv√©nements d'installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            statusDiv.className = 'status success';
            statusDiv.textContent = '‚úÖ PWA pr√™t √† √™tre install√©';
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'üéâ PWA install√© avec succ√®s !';
                } else {
                    statusDiv.className = 'status warning';
                    statusDiv.textContent = '‚ùå Installation annul√©e';
                }
                deferredPrompt = null;
                installBtn.style.display = 'none';
            }
        });

        resetBtn.addEventListener('click', () => {
            localStorage.removeItem('pwa-installation-accepted');
            localStorage.removeItem('pwa-installation-dismissed');
            localStorage.removeItem('pwa-installation-dismissed-timestamp');
            updateStatus();
        });

        // Mise √† jour initiale
        updateStatus();
        
        // V√©rifier le service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistration().then(registration => {
                if (registration) {
                    console.log('‚úÖ Service Worker actif');
                } else {
                    console.log('‚ùå Service Worker non trouv√©');
                }
            });
        }
    </script>
</body>
</html>